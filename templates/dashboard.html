<!DOCTYPE html>
<html>
<head>
    <title>AutoAffiliate Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial; background:#111; color:#eee; padding:20px; }
        h1 { color:#4af; }
        button { padding:10px 16px; margin:5px; background:#4af; color:#fff; border:none; border-radius:6px; cursor:pointer; }
        button.red { background:#d33; }
        .card { background:#222; padding:20px; margin-top:20px; border-radius:10px; }
        input[type=text] { width:70%; padding:10px; border-radius:6px; border:1px solid #555; background:#000; color:#eee;}
        table { width:100%; border-collapse:collapse; margin-top:20px; }
        th,td { padding:10px; border-bottom:1px solid #444; }
        .ok { color:#4f4; }
        .fail { color:#f44; }
    </style>
</head>
<body>

<h1>AutoAffiliate Dashboard</h1>

<div class="card">
    <h2>Worker Status</h2>
    <p>
        Status: 
        {% if worker_running %}
            <span class="ok">RUNNING</span>
        {% else %}
            <span class="fail">STOPPED</span>
        {% endif %}
    </p>
    <button onclick="startWorker()">Start Worker</button>
    <button class="red" onclick="stopWorker()">Stop Worker</button>
</div>

<div class="card">
    <h2>Stats</h2>
    <p>Sent posts: <b>{{ sent_count }}</b></p>
    <p>Pending: <b>{{ pending_count }}</b></p>
</div>

<div class="card">
    <h2>Manual Add Link</h2>
    <input id="man_url" type="text" placeholder="https://product.com/deal">
    <button onclick="addLink()">Add</button>
</div>

<div class="card">
    <h2>Force Refresh Affiliate Sources</h2>
    <button onclick="refreshSources()">Refresh Now</button>
</div>

<div class="card">
    <h2>Recent Posts</h2>
    <table>
        <tr>
            <th>ID</th><th>URL</th><th>Source</th><th>Status</th><th>Created</th><th>Posted</th>
        </tr>
        {% for p in posts %}
        <tr>
            <td>{{ p.id }}</td>
            <td><a href="{{ p.url }}" target="_blank" style="color:#4af">{{ p.url }}</a></td>
            <td>{{ p.source }}</td>
            <td>{{ p.status }}</td>
            <td>{{ p.created_at }}</td>
            <td>{{ p.posted_at }}</td>
        </tr>
        {% endfor %}
    </table>
</div>

<script>
function addLink(){
    let u = document.getElementById("man_url").value;
    fetch("/api/add", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({url:u})
    }).then(r=>r.json()).then(x=>location.reload());
}

function refreshSources(){
    fetch("/api/refresh", {method:"POST"})
    .then(r=>r.json()).then(x=>location.reload());
}

function startWorker(){
    fetch("/api/worker/start", {method:"POST"})
    .then(r=>r.json()).then(x=>location.reload());
}

function stopWorker(){
    fetch("/api/worker/stop", {method:"POST"})
    .then(r=>r.json()).then(x=>location.reload());
}
</script>

</body>
</html>
